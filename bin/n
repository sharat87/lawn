#!/bin/bash

# Load the given task from first argument, or the default-task
task="${1:-default-task}"
shift

# Find the project directory.
project_dir="$PWD"
while [[ ! -f "$project_dir/nakefile" && ! -z "$project_dir" ]]; do
    project_dir="${project_dir%/*}"
done

if [[ ! -f nakefile ]]; then
    echo nakefile not found >&2
    exit 1
fi

# Go into the project dir and load the nakefile
cd "$project_dir"
. nakefile

# Run the task with the given arguments.
"$task" "$@"
