# Keep sensitive information away from repository files
source ~/lawn/mutt/read-creds|

set spoolfile = "+/inbox"
set postponed = "+/drafts"
set record = "+/sent"

# Generated list of all addresses in my corporate ldap server
source ~/.mutt/ldap-aliases.mutt

set query_command = "python ~/lawn/mail/address-book.py '%s'"
set display_filter = ~/lawn/mutt/display-filter

set forward_format = "Fwd: %s"

# Don't show me the meta directories when changing mailboxes
set mask = '!^\.[^.]|.cmeta$|.index$|.index.data$"

set header_cache = ~/.mutt/cache/headers
set message_cachedir = ~/.mutt/cache/bodies
set certificate_file = ~/.mutt/certificates

set history = 5000
set history_file = ~/.mutt/history
set save_history = 5000

set signature = ~/lawn/mutt/signature
set sig_on_top
unset sig_dashes

set include = yes

set index_format = "%Z %[%d %b] %-20.20L %s"

set delete = yes

set beep_new = yes
set smart_wrap

set header
set edit_headers

set editor = 'vim "+normal }jzt"'

set mail_check = 2

auto_view text/html

bind index <BackTab> previous-new-then-unread

bind index,browser,attach O tag-prefix
bind generic \; enter-command
bind pager \; enter-command

bind index $ sort-mailbox
bind browser $ sort

bind index L bottom-page
bind index o display-message
bind index,pager \cj sync-mailbox # enter key

bind alias,browser o select-entry
bind attach,compose o view-attach
bind alias,browser,attach,compose i exit

bind index,browser gg first-entry
bind index,browser G last-entry
bind pager gg top
bind pager G bottom

bind pager <Up> previous-line
bind pager <Down> next-line

# Half-up is not exactly half, it needs one more previous-line
bind index,pager,browser \cu half-up
bind index,pager,browser \cd half-down

bind index,pager gr reply
bind index,pager r group-reply

bind index,pager ,r refresh

macro index,pager ,d ":unset wait_key\n|~/Dropbox/Private/open-hd-from-mail\n:set wait_key\n" "Open desc page from mail"
macro index,pager ,k ":unset wait_key\n|~/Dropbox/Private/add-email-to-tasks\n:set wait_key\n" "Add this email as a task"

macro index,pager gi "<change-folder>=inbox<enter>" "Open Inbox"
macro index,pager gd "<change-folder>=drafts<enter>" "Open Drafts"
macro index,pager gs "<change-folder>=sent<enter>" "Open Sent Mail"

# Notmuch search
macro index g/ \
    ":unset wait_key\n|~/bin/mutt-notmuch --prompt search\n<change-folder-readonly>~/.cache/mutt_results\n" \
    "search mail using notmuch"
macro index gt \
    ":unset wait_key\n|~/bin/mutt-notmuch thread\n<change-folder-readonly>~/.cache/mutt_results\n:set wait_key\n" \
    "search and reconstruct owning thread (using notmuch)"

source ~/lawn/mutt/solarized-colors/mutt-colors-solarized-dark-16.muttrc
